# PortFlux 프로젝트 문제점 분석 보고서
> 학원 발표용 프로젝트 기준

**작성일**: 2025-12-25
**분석 대상**: PortFlux (React + Spring Boot + Oracle DB)

---

## 📑 목차
- [🔴 Priority 1 - 치명적](#-priority-1---치명적)
- [🟡 Priority 2 - 중요](#-priority-2---중요)
- [🟢 Priority 3 - 경미](#-priority-3---경미)
- [⚙️ 아키텍처 및 설계 개선](#️-아키텍처-및-설계-개선-사항)
- [📋 학원 발표 시 예상 문제점](#-학원-발표-시-예상-문제점)
- [🎯 필수 수정 체크리스트](#-발표-전-필수-수정-체크리스트)
- [💡 권장 작업 순서](#-권장-작업-순서)

---

## 🔴 Priority 1 - 치명적
> **발표 전 반드시 수정 필요**

### 1. JWT 시크릿 키 동적 생성 문제

**📁 파일**: `backend\src\main\java\com\portflux\backend\security\JwtTokenProvider.java` (Line 26)

**❌ 문제점**:
- 애플리케이션이 재시작될 때마다 새로운 JWT 시크릿 키가 생성됨
- 재시작 시 이전에 발급된 모든 토큰이 무효화됨
- 사용자가 강제 로그아웃되는 심각한 UX 문제 발생
- ⚠️ **학원 발표 중 서버 재시작 시 데모가 실패할 수 있음**

**현재 코드**:
```java
private final SecretKey jwtSecretKey = Keys.secretKeyFor(SignatureAlgorithm.HS512);
```

**✅ 해결 방법**:
- application.properties에 고정된 JWT 시크릿 키 설정
- 또는 환경변수로 관리

**영향도**: ⭐⭐⭐⭐⭐ (매우 높음)

---

### 2. 사용자 인증/인가 보안 취약점 (IDOR 취약점)

**📁 파일**:
- `backend\src\main\java\com\portflux\backend\controller\CartController.java`
- `backend\src\main\java\com\portflux\backend\controller\OrderController.java`

**❌ 문제점**:
- 사용자가 URL이나 요청에서 userId를 직접 전달
- 다른 사용자의 userId를 입력하면 타인의 장바구니/주문 내역 조회 가능
- **IDOR (Insecure Direct Object Reference) 취약점**
- 실제 운영 시 심각한 개인정보 유출 가능

**예시**:
```
GET /api/cart/1  → 1번 사용자 장바구니
GET /api/cart/2  → URL만 바꾸면 2번 사용자 장바구니도 조회 가능!
```

**현재 코드**:
```java
@GetMapping("/{userId}")
public ResponseEntity<CartResponse> getCart(@PathVariable("userId") Long userId)
```

**✅ 해결 방법**:
- Spring Security의 `@AuthenticationPrincipal` 사용
- JWT 토큰에서 사용자 정보 추출하여 사용
- PathVariable로 userId 받지 않기

**영향도**: ⭐⭐⭐⭐⭐ (매우 높음)

---

### 3. 민감한 API 엔드포인트 인증 누락

**📁 파일**: `backend\src\main\java\com\portflux\backend\config\SecurityConfig.java`

**❌ 문제점**:
- `/user/info/**` 엔드포인트가 인증 없이 누구나 접근 가능
- 악의적인 사용자가 다른 사용자의 정보를 조회/수정할 수 있음

**현재 코드**:
```java
.requestMatchers("/user/info/**").permitAll()
```

**✅ 해결 방법**:
```java
.requestMatchers("/user/info/**").authenticated()
```

**영향도**: ⭐⭐⭐⭐⭐ (매우 높음)

---

### 4. 민감한 정보 하드코딩 및 Git 노출

**📁 파일**: `backend\src\main\resources\application.properties`

**🚨 노출된 민감 정보**:
- 데이터베이스 계정: `jh / 12345`
- 국세청 API 키: `66cb9cd1329391f1417b526a84413535eb81f577ce366ab785c50e76913c8954`
- Google OAuth 클라이언트 ID 및 시크릿
- Gmail 계정 및 앱 비밀번호: `rlaehdgn80@gmail.com / etunfgcpprunpybk`
- 아임포트 결제 API 키 및 시크릿
- OpenAI API 키 (`.env` 파일)

**❌ 문제점**:
- Git 히스토리에 이미 커밋되어 있음
- 누군가 저장소를 복제하면 모든 API 키 사용 가능
- ⚠️ **GitHub 공개 저장소인 경우 즉시 악용 가능**

**✅ 해결 방법**:
1. 모든 민감 정보를 환경변수로 이동
2. Git 히스토리에서 민감 정보 제거 (`git filter-branch` 또는 BFG Repo-Cleaner)
3. `.gitignore`에 `application.properties` 및 `.env` 추가 확인
4. 노출된 API 키 모두 재발급

**영향도**: ⭐⭐⭐⭐⭐ (매우 높음)

---

## 🟡 Priority 2 - 중요
> **발표 전 수정 권장**

### 5. 프론트엔드 백엔드 URL 하드코딩 (47개 파일)

**📁 주요 파일**:
- `frontend\src\pages\BoardLookupPage.jsx` (5건)
- `frontend\src\pages\BoardLookupRead.jsx` (9건)
- `frontend\src\pages\CartPage.jsx`
- `frontend\src\api\chatRest.js`
- `frontend\src\api\chatSocket.js`
- 기타 40개 이상의 파일

**❌ 문제점**:
- `http://localhost:8080`이 47개 파일에 하드코딩됨
- Vite 프록시 설정(`vite.config.js`)이 있음에도 불구하고 직접 URL 사용
- 배포 시 모든 파일을 수정해야 함
- 환경별 설정 관리 불가능
- CORS 문제 발생 가능성

**예시**:
```javascript
const response = await axios.get('http://localhost:8080/api/boardlookup/posts', {
```

**✅ 해결 방법**:
- 모든 `http://localhost:8080`을 `/api`로 변경
- Vite 프록시 활용
- 또는 환경변수 (`.env`) 사용

**영향도**: ⭐⭐⭐⭐ (높음)

---

### 6. API 사용 방식의 비일관성

**❌ 문제점**:
- 일부는 `vite.config.js`의 프록시를 활용 (`/api` prefix)
- 일부는 `http://localhost:8080`을 직접 호출
- `axios` 인스턴스(`api.js`)를 사용하는 곳과 직접 호출하는 곳이 혼재
- WebSocket은 9092 포트 사용 (`http://localhost:9092`)

**✅ 해결 방법**:
- 통일된 API 호출 방식 정의
- axios 인스턴스 통일 사용

**영향도**: ⭐⭐⭐ (보통)

---

### 7. 데이터베이스 의존성 및 환경 설정 문제

**📁 파일**: `backend\src\main\resources\application.properties`

**현재 설정**:
```properties
spring.datasource.url=jdbc:oracle:thin:@localhost:1521/xe
spring.datasource.username=jh
spring.datasource.password=12345
```

**❌ 문제점**:
- Oracle DB가 `localhost:1521`에서 실행되어야 함
- 특정 계정(`jh`)과 스키마가 미리 설정되어 있어야 함
- 다른 환경에서 실행 시 즉시 실패
- ⚠️ **학원 발표 시 다른 PC에서 실행이 어려움**

**✅ 해결 방법**:
- `README.md`에 데이터베이스 설정 방법 상세 문서화
- `sql` 폴더의 `PortFlux.sql` 실행 가이드 추가
- Docker Compose로 DB 환경 제공 고려

**영향도**: ⭐⭐⭐⭐ (높음)

---

### 8. TODO 주석 방치 (8개)

**주요 TODO**:
```java
// TODO: 실무에서는 PathVariable 대신 @AuthenticationPrincipal 사용
// TODO: 현재는 인증 없이 userId를 request에서 받습니다.
// TODO: 금액 불일치 시 결제 취소 로직 추가
```

**❌ 문제점**:
- 구현이 완료되지 않은 중요 기능들이 있음을 시사
- 보안 관련 TODO가 방치됨
- 발표 시 미완성 프로젝트로 보일 수 있음

**✅ 해결 방법**:
- 보안 관련 TODO 우선 처리
- 처리 불가능한 TODO는 삭제하고 문서화

**영향도**: ⭐⭐⭐ (보통)

---

### 9. 파일 업로드 경로 설정 문제

**📁 파일**: `backend\src\main\resources\application.properties`

**현재 설정**:
```properties
file.upload-dir=uploads
```

**❌ 문제점**:
- 절대 경로가 아닌 상대 경로 사용
- 업로드된 파일의 위치가 애매함
- 재시작 시 파일 손실 가능성
- 배포 환경에서 문제 발생 가능

**✅ 해결 방법**:
- 절대 경로 설정
- 또는 환경변수로 관리

**영향도**: ⭐⭐⭐ (보통)

---

### 10. CORS 설정 문제

**📁 파일**: `backend\src\main\java\com\portflux\backend\config\WebConfig.java`

**현재 설정**:
```java
.allowedOrigins("http://localhost:5173", "http://localhost:3000")
```

**❌ 문제점**:
- 특정 포트만 허용
- 배포 시 프론트엔드 URL 변경 필요
- 개발/운영 환경 분리 어려움

**✅ 해결 방법**:
- 환경변수로 관리
- `allowedOriginPatterns` 사용 고려

**영향도**: ⭐⭐⭐ (보통)

---

## 🟢 Priority 3 - 경미
> **시간 있을 때 개선**

### 11. 디버깅 코드 방치 (48개 이상)

**📁 주요 위치**:
- `frontend\src\pages\BoardLookupPage.jsx`
- `frontend\src\pages\CartPage.jsx`
- `backend\src\main\java\com\portflux\backend\controller\*.java`

**❌ 문제점**:
- 프로덕션 코드에 `console.log` / `System.out.println` 남아있음
- 민감한 정보가 콘솔에 노출될 수 있음
- 전문성이 떨어져 보임

**예시**:
```javascript
console.log("주문 내역:", response.data);
System.out.println("=== 장바구니 추가 ===");
```

**✅ 해결 방법**:
- 모든 디버깅 코드 제거
- 또는 로깅 프레임워크(SLF4J, Log4j) 사용

**영향도**: ⭐⭐ (낮음)

---

### 12. 에러 처리 미흡

**❌ 문제점**:
- 대부분의 에러가 `alert()`로 처리됨
- 사용자 친화적이지 않은 에러 메시지
- 백엔드 에러 메시지가 그대로 노출

**예시**:
```javascript
alert("장바구니 추가에 실패했습니다.");
```

**✅ 해결 방법**:
- 통일된 에러 처리 전략 수립
- Toast 메시지로 에러 표시
- 사용자 친화적인 메시지로 변환

**영향도**: ⭐⭐ (낮음)

---

### 13. 주석 및 코드 스타일 비일관성

**❌ 문제점**:
- 한글 주석과 영어 주석 혼재
- 주석 스타일 비일관성
- 코드 포맷팅 불일치

**✅ 해결 방법**:
- ESLint / Prettier 설정 통일
- 주석 언어 통일 (권장: 영어)

**영향도**: ⭐ (매우 낮음)

---

### 14. 미사용 import 및 변수

**❌ 문제점**:
- 사용하지 않는 import 문 존재
- 미사용 변수 및 함수

**✅ 해결 방법**:
- ESLint로 자동 탐지 및 제거
- IDE의 코드 정리 기능 활용

**영향도**: ⭐ (매우 낮음)

---

### 15. Git 커밋 메시지 비일관성

**현재 커밋 메시지**:
- "SQL 주석"
- "장바구니, 결제내역 페이지 완성 (SQL 9차로 업데이트 해주세요!!)"
- "장바구니 완성~"

**❌ 문제점**:
- 커밋 메시지 스타일 비일관성
- 의미 없는 메시지

**✅ 해결 방법**:
- 커밋 메시지 컨벤션 정의 (Conventional Commits)
- 예: `feat: 장바구니 기능 추가`

**영향도**: ⭐ (매우 낮음)

---

## ⚙️ 아키텍처 및 설계 개선 사항

### 16. 프론트엔드 상태 관리

**현재 상황**:
- `useState`로만 상태 관리
- `localStorage`/`sessionStorage` 직접 사용
- 전역 상태 관리 부재

**✅ 개선 방안**:
- Context API 또는 Zustand/Recoil 도입 고려
- 사용자 인증 상태 전역 관리

**영향도**: ⭐⭐ (낮음)

---

### 17. API 응답 형식 비일관성

**❌ 문제점**:
- 일부 API는 객체 반환
- 일부 API는 배열 반환
- 에러 응답 형식 통일되지 않음

**✅ 개선 방안**:
- 통일된 API 응답 형식 정의
- 예: `{ success: boolean, data: any, error: string }`

**영향도**: ⭐⭐ (낮음)

---

### 18. 컴포넌트 재사용성

**❌ 문제점**:
- 중복된 코드 존재
- 공통 컴포넌트 부족

**✅ 개선 방안**:
- 공통 컴포넌트 추출
- UI 라이브러리 도입 고려

**영향도**: ⭐⭐ (낮음)

---

## 📋 학원 발표 시 예상 문제점

1. ⚠️ 데모 중 서버 재시작 시 모든 사용자 강제 로그아웃 (JWT 키 문제)
2. ⚠️ 다른 PC에서 실행 불가 (DB 설정 문제)
3. ⚠️ 보안 취약점 지적 시 답변 곤란 (IDOR, 인증 누락)
4. ⚠️ GitHub 공개 저장소인 경우 즉시 API 키 악용 가능
5. ⚠️ 타인의 장바구니/주문 조회 가능 문제 지적 가능

---

## 🎯 발표 전 필수 수정 체크리스트

- [ ] **1. JWT 시크릿 키를 고정값으로 변경** (Priority 1-1)
- [ ] **2. CartController, OrderController 인증 수정** (Priority 1-2)
- [ ] **3. /user/info/\*\* 엔드포인트에 인증 추가** (Priority 1-3)
- [ ] **4. application.properties 민감 정보 환경변수화** (Priority 1-4)
- [ ] 5. 프론트엔드 URL 하드코딩 제거 (Priority 2-5)
- [ ] 6. 데이터베이스 설정 문서 작성 (Priority 2-7)
- [ ] 7. TODO 주석 처리 또는 삭제 (Priority 2-8)
- [ ] 8. 디버깅 코드 정리 (Priority 3-11)

---

## 💡 권장 작업 순서

### 1단계 (필수 - 1~2시간)
1. JWT 시크릿 키 고정
2. 사용자 인증/인가 수정 (Cart, Order)
3. /user/info 인증 추가

### 2단계 (중요 - 2~3시간)
1. 프론트엔드 URL 하드코딩 제거
2. 민감 정보 환경변수화
3. README 작성

### 3단계 (선택 - 1시간)
1. 디버깅 코드 제거
2. TODO 정리
3. 에러 처리 개선

---

## 📚 참고 자료

### 보안
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [JWT 베스트 프랙티스](https://tools.ietf.org/html/rfc8725)

### Spring Security
- @AuthenticationPrincipal 사용법
- Spring Security Context 활용

### 환경 변수
- Spring Boot @ConfigurationProperties
- React Vite 환경변수 (.env)

---

**생성일**: 2025-12-25
**분석 도구**: Claude Code (Claude Sonnet 4.5)
**프로젝트**: PortFlux
